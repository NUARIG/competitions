
= render 'shared/grant_edit_tabbed_menu', { grant: @submission.grant }

.tabs-panel.is-active
  %h3
    = "Reviews of #{@submission.title}:"

  #reviews-overview.grid-container-x
    .grid-x
      .cell.small-12.medium-2
        %strong
          Submission:
      .cell.small-12.medium-10
        = link_to @submission.title, grant_submission_path(@submission.grant, @submission)
    .grid-x
      .cell.small-12.medium-2
        %strong
          Applicant:
      .cell.small-12.medium-10
        = full_name(@submission.applicant)
    .grid-x.grid-padding-y
      .cell.small-12
        - if @reviews.empty?
          %p
            - if @submission.submitted?
              There are no reviews for this submission.
              = link_to 'Assign it to a reviewer', grant_reviewers_path(@grant)
            - elsif @submission.draft?
              This submission must be completed before it can be reviewed.
        - else

          = render 'shared/pagy_header', locals: { pagy: @pagy }

          %table.hover.stack
            %thead
              %tr
                %th
                  = sort_link(@q, :reviewer_last_name, 'Reviewer')
                %th
                  = sort_link(@q, :overall_impact, 'Review')
                %th
                  = sort_link(@q, :overall_impact)
                %th
                  Composite
                - @grant.criteria.each do |criterion|
                  %th= criterion.name
            %tbody
              = render @reviews

    - if @reviews.completed.any?

      .grid-x.grid-padding-y
        .cell.small-12
          %h3
            Scores and Comments

      - @grant.criteria.each do |criterion|
        .grid-x.grid-y
          .row
            .cell.small-12
              %h5{id: "criterion-#{criterion.id}"}
                = criterion.name
          .row
            .cell.small-12
              - @reviews.completed.each do |review|
                .grid-x.review
                  .cell.small-12.medium-2.reviewer
                    = full_name(review.reviewer)
                  .cell.small-12.medium-10.responses
                    .grid-y
                      - scored_criterion = review.criteria_reviews.to_a.detect {|score| score.criterion_id == criterion.id}
                      - if scored_criterion
                        .row
                          = scored_criterion.score
                        .row
                          = scored_criterion.comment
                      - else
                        NS

